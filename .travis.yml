language: php

php:
- 5.2

env:
  - WP_VERSION=latest WP_MULTISITE=0
  - WP_VERSION=4.1 WP_MULTISITE=1

before_script:
    - sudo apt-get install ruby
    - gem install nyx
    - export PHPCS_GITHUB_SRC=squizlabs/PHP_CodeSniffer
    - export PHPCS_DIR=/tmp/phpcs
    - export PHPCS_BRANCH=phpcs-fixer
    - mkdir -p $PHPCS_DIR && git clone --depth 1 https://github.com/squizlabs/PHP_CodeSniffer.git -b $PHPCS_BRANCH $PHPCS_DIR
    - $PHPCS_DIR/scripts/phpcs --config-set installed_paths $(pwd)

script:
    - find . \( -name '*.php' \) -exec php -lf {} \;
    - phpunit --filter WordPress /tmp/phpcs/tests/AllTests.php
    - nyx version
    - nyx check:php .
    
notifications:
  email:
    recipients:
    - andrei.lupu@pixelgrade.com
    on_failure: always
